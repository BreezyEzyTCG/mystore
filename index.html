<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PokÃ©mon Card Store</title>
  <style>
    :root{
      --icon-color-default:#ddeaef; /* inactive icon color */
      --icon-color-active:#789cac;  /* active icon color */
    }

    body{
      font-family:Arial, sans-serif;
      margin:0;
      background:#f0f4f8;
    }

    header{
      background:#1a202c;
      color:#fff;
      padding:1rem;
      text-align:center;
      position:sticky; top:0; z-index:10;
    }

    .cart-link{
      position:absolute; right:1rem; top:1rem;
      color:#fff; text-decoration:none;
      background:#2d3748; padding:0.5rem 1rem; border-radius:5px;
    }

    /* ---------- Controls layout ---------- */
    .controls{
      max-width:1200px;
      margin:1.5rem auto 0;
      padding:0 1rem;                 /* align with card container */
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:0.75rem;
      flex-wrap:wrap;
    }

    /* Row 1 on mobile (centered category). On desktop it just sits to the left. */
    .controls-top{
      display:flex;
      width:auto;
      align-items:center;
    }

    .controls-bottom{
      display:flex;
      align-items:center;
      gap:0.75rem;
      flex:1;                         /* lets the search stretch */
      justify-content:space-between;  /* search left, toggle right */
      min-width:0;
    }

    .search-wrap{
      flex:1; min-width:0;
    }

    .controls select,
    .controls input{
      padding:0.5rem;
      border-radius:5px;
      border:1px solid #ccc;
      background:#fff;
    }
    #search{ width:100%; }

    /* Grid toggle */
    .grid-toggle{
      display:flex;
      gap:0.5rem;
      margin:0;                       /* no extra vertical space */
    }
    .layout-button{
      background:transparent; border:none;
      padding:0.5rem; border-radius:6px; cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      transition:transform .15s ease;
    }
    .layout-button:active{ transform:scale(0.96); }
    .layout-button svg{ width:24px; height:24px; fill:var(--icon-color-default); transition:fill .2s ease; }
    .layout-button.single svg{ width:30px; height:30px; }
    .layout-button.active svg{ fill:var(--icon-color-active); }

    /* Card grid */
    .card-container{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(250px, 1fr));
      gap:1.5rem;
      max-width:1200px;
      margin:2rem auto;
      padding:0 1rem;
      transition:all .3s ease;
    }
    .card-container.grid-1{ grid-template-columns:repeat(1, 1fr); }
    .card-container.grid-2{ grid-template-columns:repeat(2, 1fr); }
    .card-container.grid-3{ grid-template-columns:repeat(3, 1fr); }

    .card{
      position:relative; background:#fff; border-radius:10px;
      box-shadow:0 4px 10px rgba(0,0,0,.08);
      overflow:hidden; display:flex; flex-direction:column;
      padding:1rem; text-align:center;
    }
    .card img{ width:100%; aspect-ratio:4/3; object-fit:contain; margin-bottom:.5rem; border-radius:5px; }
    .title-block{ min-height:calc(1 * 1.2em + 3 * 1.3em); }
    .card-title{
      font-size:1.25rem; margin:.25rem 0; line-height:1.2;
      display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:1; overflow:hidden; min-height:1.2em;
    }
    .series-name{
      font-size:.7rem; color:#555; margin:.2rem 0 .6rem; font-style:italic;
      display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:3; overflow:hidden; line-height:1.3; min-height:calc(3 * 1.3em);
    }
    .card-info{ min-height:90px; display:flex; flex-direction:column; justify-content:flex-start; }
    .condition,.price,.stock{ font-size:1rem; margin:.35rem 0; }

    /* Badges */
    .badge{
      position:absolute; top:.5rem; left:.5rem;
      padding:5px 10px; font-size:.75rem; font-weight:bold; border-radius:4px; z-index:2;
      text-transform:uppercase; box-shadow:0 2px 5px rgba(0,0,0,.2); line-height:1;
    }
    .badge.sale{ background:#e02424; color:#fff; }
    .badge.popular{ background:#ffcc00; color:#000; }
    .badge.new{ background:#2fbf71; color:#f8f9fb; }

    .product-actions{ margin-top:auto; }
    button{ margin-top:.5rem; padding:.5rem 1rem; background:#2b6cb0; color:#fff; border:none; border-radius:5px; cursor:pointer; }

    .container-panel{
      max-width:1200px; margin:2rem auto; padding:0 1rem;
      background:#fff; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,.05);
    }

    /* --- Mobile tweaks: center Categories above, row with Search (left) + Toggle (right) --- */
    @media (max-width:767.98px){
      .controls{
        flex-direction:column;         /* stack rows */
        align-items:stretch;
      }
      .controls-top{
        width:100%;
        justify-content:center;        /* centered dropdown */
        order:0;
      }
      .controls-bottom{
        width:100%;
        order:1;
      }
      /* Hide 3-grid on mobile */
      .layout-button.triple{ display:none; }
    }

    /* Desktop: hide single-pane icon */
    @media (min-width:768px){
      .layout-button.single{ display:none; }
    }
  </style>
</head>
<body>
  <header>
    <h1>BreezyEzyTCG Collectibles Store</h1>
    <a class="cart-link" href="cart.html">ðŸ›’ Cart</a>
  </header>

  <div class="container-panel">
    <div class="controls">
      <!-- Row 1 on mobile (centered); sits left on desktop -->
      <div class="controls-top">
        <select id="category-filter" onchange="applyFilters()">
          <option value="all">All Categories</option>
        </select>
      </div>

      <!-- Row 2: search left, toggle right (both desktop & mobile) -->
      <div class="controls-bottom">
        <div class="search-wrap">
          <input type="text" id="search" placeholder="Search for a card..." oninput="applyFilters()" />
        </div>

        <div class="grid-toggle">
          <!-- Single Pane -->
          <button class="layout-button single" type="button" onclick="setGridView(1)" aria-label="Single column">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="3" ry="3"/></svg>
          </button>

          <!-- 2-Grid -->
          <button class="layout-button double active" type="button" onclick="setGridView(2)" aria-label="Two columns">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M5 2a3 3 0 0 0-3 3v3a3 3 0 0 0 3 3h3a3 3 0 0 0 3-3V5a3 3 0 0 0-3-3H5Zm11 11a3 3 0 0 0-3 3v3a3 3 0 0 0 3 3h3a3 3 0 0 0 3-3v-3a3 3 0 0 0-3-3h-3Zm0-2a3 3 0 0 1-3-3V5a3 3 0 0 1 3-3h3a3 3 0 0 1 3 3v3a3 3 0 0 1-3 3h-3ZM5 22a3 3 0 0 1-3-3v-3a3 3 0 0 1 3-3h3a3 3 0 0 1 3 3v3a3 3 0 0 1-3 3H5Z" clip-rule="evenodd"/>
            </svg>
          </button>

          <!-- 3-Grid -->
          <button class="layout-button triple" type="button" onclick="setGridView(3)" aria-label="Three columns">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <path fill-rule="evenodd" d="M4 5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H4Zm7 0a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2Zm7 6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2ZM4 12a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2H4Zm7 0a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2h-2Zm7 6a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-2Z" clip-rule="evenodd"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="card-container grid-2"></div>
  </div>

  <div id="toast" style="display:none; position:fixed; bottom:10px; right:10px; background:#333; color:#fff; padding:10px 15px; border-radius:5px; z-index:1000;"></div>

  <script>
    let allProducts = [];

    function isMobile(){ return window.matchMedia("(max-width: 767.98px)").matches; }

    function showToast(message){
      const toast = document.getElementById("toast");
      toast.innerText = message;
      toast.style.display = "block";
      setTimeout(()=> toast.style.display = "none", 2000);
    }

    function addToCart(name, price, image_url){
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      const existing = cart.find(i => i.name === name);
      if(existing) existing.quantity += 1;
      else cart.push({ name, price, quantity: 1, image: image_url });
      localStorage.setItem("cart", JSON.stringify(cart));
      showToast(`${name} added to cart!`);
    }

    async function fetchInventoryFromSheet(){
      const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRDJRZBMe5zGA4VmLoAQnCV1X21yZN7nmGy9U0UChcldGIV4r7FX3-9XgEbvrsEOL6nJn8VhY58Ic50/pub?output=csv";
      try{
        const res = await fetch(sheetURL);
        const text = await res.text();
        const rows = text.trim().split("\n").map(r => r.split(","));
        const headers = rows.shift().map(h => h.trim().toLowerCase());
        allProducts = rows.map(row => {
          const obj = {};
          row.forEach((cell, i) => {
            const key = headers[i];
            obj[key] = (key === "price" || key === "stock") ? parseFloat(cell) : (cell || "").trim();
          });
          return obj;
        });
        populateCategoryDropdown();
        renderStore(allProducts);
      }catch(e){
        console.error("Failed to load inventory:", e);
        document.querySelector(".card-container").innerHTML = "<p>Error loading store inventory.</p>";
      }
    }

    function getBadgeInfo(raw){
      if(!raw) return null;
      const t = String(raw).trim().toLowerCase();
      if(["sale","sales"].includes(t)) return { cls:"sale", label:"S
